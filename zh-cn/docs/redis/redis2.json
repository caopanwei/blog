{
  "filename": "redis2.md",
  "__html": "<h1>Redis主从模式详解</h1>\n<!-- TOC -->\n<ul>\n<li><a href=\"#redis%E4%B8%BB%E4%BB%8E%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3\">Redis主从模式详解</a>\n<ul>\n<li><a href=\"#1redis%E4%B8%BB%E4%BB%8E%E6%A8%A1%E5%BC%8F\">1.Redis主从模式</a>\n<ul>\n<li><a href=\"#11%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E5%91%BD%E4%BB%A4\">1.1主从复制命令</a></li>\n<li><a href=\"#12redis%E4%B8%BB%E4%BB%8E%E6%8B%93%E6%89%91\">1.2Redis主从拓扑</a>\n<ul>\n<li><a href=\"#%E4%B8%80%E4%B8%BB%E4%B8%80%E4%BB%8E\">一主一从</a></li>\n<li><a href=\"#%E4%B8%80%E4%B8%BB%E5%A4%9A%E4%BB%8E\">一主多从</a></li>\n<li><a href=\"#%E6%A0%91%E7%8A%B6%E4%B8%BB%E4%BB%8E\">树状主从</a></li>\n</ul>\n</li>\n<li><a href=\"#13%E4%B8%BB%E4%BB%8E%E5%8E%9F%E7%90%86\">1.3主从原理</a></li>\n<li><a href=\"#14%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5\">1.4数据同步</a></li>\n<li><a href=\"#15%E7%BC%BA%E7%82%B9\">1.5缺点</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<!-- /TOC -->\n<h2>1.Redis主从模式</h2>\n<h3>1.1主从复制命令</h3>\n<p>a,方式一、新增redis6380.conf, 加入  slaveof 192.168.42.111 6379,  在6379启动完后再启6380，完成配置；<br>\nb,方式二、redis-server --slaveof 192.168.42.111 6379<br>\nc,查看状态：info replication<br>\nd,断开主从复制：在slave节点，执行6380:&gt;slaveof no one<br>\ne,断开后再变成主从复制：6380:&gt; slaveof 192.168.42.111 6379<br>\nf,数据较重要的节点，主从复制时使用密码验证： requirepass<br>\ne,从节点建议用只读模式slave-read-only=yes, 若从节点修改数据，主从数据不一致</p>\n<h3>1.2Redis主从拓扑</h3>\n<h4>一主一从</h4>\n<p>用于主节点故障转移从节点，当主节点的“写”命令并发高且需要持久化，可以只在从节点开启AOF（主节点不需要）\n<img src=\"https://gitee.com/cpw/commonimage/raw/master/QQ20190420-165257@2x.png\" alt=\"\"></p>\n<h4>一主多从</h4>\n<p>针对“读”较多的场景，“读”由多个从节点来分担，但节点越多，主节点同步到多节点的次数也越多，影响带宽，也加重主节点的稳定\n<img src=\"https://gitee.com/cpw/commonimage/raw/master/QQ20190420-165308@2x.png\" alt=\"\"></p>\n<h4>树状主从</h4>\n<p>一主多从的缺点（主节点推送次数多压力大）可用些方案解决，主节点只推送一次数据到从节点1，再由从节点2推送到11，减轻主节点推送的压力\n<img src=\"https://gitee.com/cpw/commonimage/raw/master/QQ20190420-165308@2x.png\" alt=\"\"></p>\n<h3>1.3主从原理</h3>\n<p>执行slave master port后，与主节点连接，同步主节点的数据,6380:&gt;info replication：查看主从及同步信息\n<img src=\"https://gitee.com/cpw/commonimage/raw/master/QQ20190420-165329@2x.png\" alt=\"\"></p>\n<h3>1.4数据同步</h3>\n<p>redis 2.8版本以上使用psync命令完成同步，过程分“全量”与“部分”复制<br>\n全量复制：<br>\n一般用于初次复制场景（第一次建立SLAVE后全量）<br>\n部分复制：<br>\n网络出现问题，从节点再次连主时，主节点补发缺少的数据，每次数据增加同步<br>\n心跳：<br>\n主从有长连接心跳，主节点默认每10S向从节点发ping命令，repl-ping-slave-period控制发送频率</p>\n<h3>1.5缺点</h3>\n<ol>\n<li>主从复制，若主节点出现问题，则不能提供服务，需要人工修改配置将从变主.</li>\n<li>主从复制主节点的写能力单机，能力有限.</li>\n<li>需要人工干预，无法实现高可用.</li>\n</ol>\n",
  "link": "/zh-cn/docs/redis/redis2.html",
  "meta": {}
}